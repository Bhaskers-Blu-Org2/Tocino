/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */

#include "tocino-net-device.h"

namespace ns3 {

TocinoNetDeviceReceiver::TocinoNetDeviceReceiver(Ptr<TocinoNetDevice> nd,
						 unsugned int port,
						 unsigned int n_ports)
{
  m_nd = nd;
  m_port = port;
  m_n_ports = n_ports;
}

void
TocinoNetDeviceReceiver::PortLinkage(unsigned int port, 
				     Ptr<TocinoNetDeviceTransmitter> transmitter, 
				     Ptr<Queue> q)
{
  m_transmitter[port] = transmitter;
  m_q[port] = q;
}

void
TocinoNetDeviceReceiver::Receive(Ptr<Packet> p)
{
  // XON packet enables transmission on this port
  if (p->isXON())
    {
      m_transmitter[port]->SetXState(XON);
      m_transmitter[port]->Transmit();
      return;
    }

  // XOFF packet disables transmission on this port
  if (p->isXOFF())
    {
      m_transmitter[port]->SetXState(XOFF);
      return;
    }

  // figure out where the packet goes and put it in the transmission queue
  tx_port = Route(p);
